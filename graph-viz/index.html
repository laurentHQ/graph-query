<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Results Service - 3D Knowledge Graph</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #071820;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    #container {
      position: fixed;
      inset: 0;
    }
    #info-panel {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 350px;
      max-height: 80vh;
      overflow-y: auto;
      background: rgba(7, 24, 32, 0.95);
      border: 2px solid #2e7bcf;
      border-radius: 8px;
      padding: 20px;
      color: #ffffff;
      font-size: 14px;
      display: none;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }
    #info-panel h3 {
      margin: 0 0 10px 0;
      color: #6ec3ff;
      font-size: 18px;
      border-bottom: 1px solid #2e7bcf;
      padding-bottom: 8px;
    }
    #info-panel .label {
      color: #9ca3af;
      font-size: 12px;
      text-transform: uppercase;
      margin-top: 12px;
      margin-bottom: 4px;
    }
    #info-panel .value {
      color: #ffffff;
      margin-bottom: 8px;
    }
    #info-panel .connection {
      padding: 6px 10px;
      margin: 4px 0;
      background: rgba(46, 123, 207, 0.2);
      border-radius: 4px;
      border-left: 3px solid #2e7bcf;
    }
    #info-panel .connection.outgoing {
      border-left-color: #f2b544;
    }
    #info-panel .connection.incoming {
      border-left-color: #6ec3ff;
    }
    #info-panel .close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      color: #9ca3af;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      line-height: 30px;
      text-align: center;
    }
    #info-panel .close-btn:hover {
      color: #ffffff;
    }
    #info-panel .action-buttons {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #2e7bcf;
      display: flex;
      gap: 10px;
    }
    #info-panel button.action-btn {
      flex: 1;
      background: linear-gradient(135deg, #2e7bcf, #1e5a8f);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.3s;
    }
    #info-panel button.action-btn:hover {
      background: linear-gradient(135deg, #3d8edf, #2e7bcf);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(46, 123, 207, 0.4);
    }
    #info-panel button.action-btn:active {
      transform: translateY(0);
    }
    #info-panel button.action-btn.active {
      background: linear-gradient(135deg, #f2b544, #d99d30);
    }
    #network-stats {
      margin-top: 10px;
      padding: 10px;
      background: rgba(46, 123, 207, 0.1);
      border-radius: 4px;
      font-size: 12px;
      color: #6ec3ff;
    }
    #instructions {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(7, 24, 32, 0.8);
      padding: 15px 20px;
      border-radius: 6px;
      color: #9ca3af;
      font-size: 13px;
      border: 1px solid #123b4a;
    }
    #hierarchy-toolbar {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(7, 24, 32, 0.95);
      border: 2px solid #2e7bcf;
      border-radius: 8px;
      padding: 15px 20px;
      color: #ffffff;
      font-size: 13px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      min-width: 320px;
    }
    #hierarchy-toolbar h4 {
      margin: 0 0 12px 0;
      color: #6ec3ff;
      font-size: 14px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    #hierarchy-toolbar .control-group {
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(46, 123, 207, 0.3);
    }
    #hierarchy-toolbar .control-group:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }
    #hierarchy-toolbar .control-label {
      color: #9ca3af;
      font-size: 11px;
      text-transform: uppercase;
      margin-bottom: 6px;
      display: block;
    }
    #hierarchy-toolbar .button-group {
      display: flex;
      gap: 8px;
    }
    #hierarchy-toolbar button {
      background: linear-gradient(135deg, #2e7bcf, #1e5a8f);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.2s;
      flex: 1;
    }
    #hierarchy-toolbar button:hover {
      background: linear-gradient(135deg, #3d8edf, #2e7bcf);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(46, 123, 207, 0.4);
    }
    #hierarchy-toolbar button:active {
      transform: translateY(0);
    }
    #hierarchy-toolbar .filter-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    #hierarchy-toolbar .filter-chip {
      background: rgba(46, 123, 207, 0.2);
      border: 1px solid #2e7bcf;
      color: #6ec3ff;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.2s;
      user-select: none;
    }
    #hierarchy-toolbar .filter-chip:hover {
      background: rgba(46, 123, 207, 0.3);
      border-color: #3d8edf;
    }
    #hierarchy-toolbar .filter-chip.active {
      background: linear-gradient(135deg, #2e7bcf, #1e5a8f);
      color: white;
      border-color: #2e7bcf;
    }
    #hierarchy-toolbar .filter-chip.importance-core {
      border-color: #f2b544;
      color: #f2b544;
    }
    #hierarchy-toolbar .filter-chip.importance-core.active {
      background: linear-gradient(135deg, #f2b544, #d99d30);
      border-color: #f2b544;
      color: white;
    }
    #hierarchy-toolbar .filter-chip.importance-supporting {
      border-color: #6ec3ff;
      color: #6ec3ff;
    }
    #hierarchy-toolbar .filter-chip.importance-supporting.active {
      background: linear-gradient(135deg, #6ec3ff, #4da3e3);
      border-color: #6ec3ff;
      color: white;
    }
    #hierarchy-toolbar .filter-chip.importance-helper {
      border-color: #9ca3af;
      color: #9ca3af;
    }
    #hierarchy-toolbar .filter-chip.importance-helper.active {
      background: linear-gradient(135deg, #9ca3af, #6b7280);
      border-color: #9ca3af;
      color: white;
    }
  </style>
</head>
<body>
<div id="container"></div>

<!-- Hierarchy Controls Toolbar -->
<div id="hierarchy-toolbar">
  <h4>Hierarchy Controls</h4>

  <div class="control-group">
    <span class="control-label">Expand / Collapse</span>
    <div class="button-group">
      <button onclick="expandAll()">Expand All</button>
      <button onclick="collapseAll()">Collapse All</button>
    </div>
  </div>

  <div class="control-group">
    <span class="control-label">Technical Level</span>
    <div class="filter-chips" id="technical-level-filters">
      <div class="filter-chip active" data-level="service" onclick="toggleTechnicalLevel('service')">Service</div>
      <div class="filter-chip active" data-level="file" onclick="toggleTechnicalLevel('file')">File</div>
      <div class="filter-chip active" data-level="endpoint" onclick="toggleTechnicalLevel('endpoint')">Endpoint</div>
      <div class="filter-chip active" data-level="class" onclick="toggleTechnicalLevel('class')">Class</div>
      <div class="filter-chip active" data-level="method" onclick="toggleTechnicalLevel('method')">Method</div>
      <div class="filter-chip active" data-level="resource" onclick="toggleTechnicalLevel('resource')">Resource</div>
    </div>
  </div>

  <div class="control-group">
    <span class="control-label">Importance Level</span>
    <div class="filter-chips" id="importance-filters">
      <div class="filter-chip importance-core active" data-importance="core" onclick="toggleImportance('core')">Core</div>
      <div class="filter-chip importance-supporting active" data-importance="supporting" onclick="toggleImportance('supporting')">Supporting</div>
      <div class="filter-chip importance-helper active" data-importance="helper" onclick="toggleImportance('helper')">Helper</div>
    </div>
  </div>
</div>

<div id="info-panel">
  <button class="close-btn" onclick="closeInfoPanel()">&times;</button>
  <div id="info-content"></div>
</div>
<div id="instructions">
  <strong>Controls:</strong> Click node to view details • Double-click to expand/collapse • Drag to rotate • Scroll to zoom
</div>

<!-- Three.js and dependencies -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>

<!-- Filter UI Logic -->
<script>
  // Track active filters
  let activeTechnicalLevels = new Set(['service', 'file', 'endpoint', 'class', 'method', 'resource']);
  let activeImportanceLevels = new Set(['core', 'supporting', 'helper']);

  // Toggle technical level filter
  window.toggleTechnicalLevel = function(level) {
    const chip = document.querySelector(`[data-level="${level}"]`);

    if (activeTechnicalLevels.has(level)) {
      activeTechnicalLevels.delete(level);
      chip.classList.remove('active');
    } else {
      activeTechnicalLevels.add(level);
      chip.classList.add('active');
    }

    // Update visualization
    if (window.setTechnicalLevelFilter) {
      window.setTechnicalLevelFilter(Array.from(activeTechnicalLevels));
    }
  };

  // Toggle importance filter
  window.toggleImportance = function(importance) {
    const chip = document.querySelector(`[data-importance="${importance}"]`);

    if (activeImportanceLevels.has(importance)) {
      activeImportanceLevels.delete(importance);
      chip.classList.remove('active');
    } else {
      activeImportanceLevels.add(importance);
      chip.classList.add('active');
    }

    // Update visualization
    if (window.setImportanceFilter) {
      window.setImportanceFilter(Array.from(activeImportanceLevels));
    }
  };
</script>

<!-- Main application module -->
<script type="module" src="js/main.js"></script>
</body>
</html>
